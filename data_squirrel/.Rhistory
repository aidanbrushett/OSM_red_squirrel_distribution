'4500 meter buffer',
'4750 meter buffer',
'5000 meter buffer')
squirrel <- buffer_frames %>%
purrr::map(
~.x %>%
left_join(dets,
by = 'site'))
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns
df <- .x %>%
select(-1:-3)
# Create a list to store the models for each variable
model_list <- map(names(df), ~ {
# Dynamically create the formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "
+ (1 | array)"))
# Run the glmmTMB model for each variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = .x,
family = 'binomial'
)
})
model_list
}
)
View(squirrel)
squirrel[["250 meter buffer"]]
View(squirrel)
squirrel[["250 meter buffer"]]
squirrel <- buffer_frames %>%
purrr::map(
~.x %>%
left_join(dets,
by = 'site') %>%
select(array, everything()))
View(squirrel)
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns
df <- .x %>%
select(-1:-3)
# Create a list to store the models for each variable
model_list <- map(names(df), ~ {
# Dynamically create the formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "
+ (1 | array)"))
# Run the glmmTMB model for each variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = .x,
family = 'binomial'
)
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns
df <- .x %>%
select(-1:-3)
# Create a list to store the models for each variable
model_list <- map(names(df), ~ {
# Dynamically create the formula, fixing the line breaks
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Run the glmmTMB model for each variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = .x,
family = 'binomial'
)
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns
df <- .x %>%
select(-1:-3)
# Create a list to store the models for each variable
model_list <- map(names(df), ~ {
# Dynamically create the formula using rlang::sym to handle variable names
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Run the glmmTMB model for each variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = .x,
family = 'binomial'
)
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns
df <- .x %>%
select(-1:-3)
# Ensure the remaining columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# Create a list to store the models for each numeric variable
model_list <- map(numeric_columns, ~ {
# Dynamically create the formula using rlang::sym to handle variable names
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = .x,
family = 'binomial'
)
})
model_list
}
)
View(squirrel)
squirrel[["250 meter buffer"]]
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns (array, site, buff_dist)
df <- .x %>%
select(-array, -site, -buff_dist)
# Identify the numeric columns (excluding the outcome variables)
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# Create a list to store the models for each numeric variable
model_list <- map(numeric_columns, ~ {
# Dynamically create the formula for each numeric column
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = .x,
family = 'binomial'
)
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns (array, site, buff_dist)
df <- .x %>%
select(-array, -site, -buff_dist)
# Identify the numeric columns (excluding the outcome variables)
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# Create a list to store the models for each numeric variable
model_list <- map(numeric_columns, ~ {
# Dynamically create the formula using rlang::sym to handle variable names
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~{
# Exclude the first three columns (array, site, buff_dist) from modelling
df <- .x %>%
select(-site, -buff_dist)  # Keep 'array' in the dataset but exclude 'site' and 'buff_dist'
# Ensure 'array' is treated as a factor (keep it for random effect)
df$array <- as.factor(.x$array)
# Identify the numeric columns (excluding the outcome variables)
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# Create a list to store the models for each numeric variable
model_list <- map(numeric_columns, ~ {
# Dynamically create the formula (excluding 'array' from the fixed effects)
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
})
model_list
}
)
View(df)
View(squirrel_mods)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_mods) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
View(squirrel_mods)
squirrel_mods[["250 meter buffer"]]
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_mods) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
squirrel_models <- unlist(squirrel_mods, recursive = TRUE)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_mods) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_moddels) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
squirrel_models <- unlist(squirrel_mods, recursive = TRUE)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
View(squirrel_models)
View(squirrel_mods)
squirrel_models <- purrr::flatten(squirrel_mods)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
# look at model selection results
squirrel_global_model.sel}
squirrel_models <- purrr::flatten(squirrel_mods)
squirrel_models <- purrr::flatten(squirrel_mods)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
# look at model selection results
squirrel_global_model.sel
View(squirrel_global_model.sel)
View(squirrel_models)
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# pass squirrel to df
df <- .x %>%
# exclude site and buff_dist
select(-site, -buff_dist)
# array treated as a factor
df$array <- as.factor(.x$array)
# make sure columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# list to store the columns
model_list <- map(numeric_columns, ~ {
# create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
model_names <- paste0(.x"_", deparse(substitute(.x)), "_buff_", buff_dist)
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# pass squirrel to df
df <- .x %>%
# exclude site and buff_dist
select(-site, -buff_dist)
# array treated as a factor
df$array <- as.factor(.x$array)
# make sure columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# list to store the columns
model_list <- map(numeric_columns, ~ {
# create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
model_names <- paste0(.x"_", deparse(substitute(.x)), "_buff_", buff_dist, "model")
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# pass squirrel to df
df <- .x %>%
# exclude site and buff_dist
select(-site, -buff_dist)
# array treated as a factor
df$array <- as.factor(.x$array)
# make sure columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# list to store the columns
model_list <- map(numeric_columns, ~ {
# create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
model_names <- paste0(.x, "_", deparse(substitute(.x)), "_buff_", buff_dist)
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
# names
names(model) <- model_name
model
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# pass squirrel to df
df <- .x %>%
# exclude site and buff_dist
select(-site, -buff_dist)
# array treated as a factor
df$array <- as.factor(.x$array)
# make sure columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# list to store the columns
model_list <- map(numeric_columns, ~ {
# create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
model_names <- paste0(.x, "_", deparse(substitute(.x)), "_buff_", covs$buff_dist)
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
# names
names(model) <- model_name
model
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# pass squirrel to df
df <- .x %>%
# exclude site and buff_dist
select(-site, -buff_dist)
# array treated as a factor
df$array <- as.factor(.x$array)
# make sure columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# list to store the columns
model_list <- map(numeric_columns, ~ {
# create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
model_name <- paste0(.x, "_", deparse(substitute(.x)), "_buff_", covs$buff_dist)
# Run the glmmTMB model for each numeric variable in the data frame
glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
# names
names(model) <- model_name
model
})
model_list
}
)
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# Pass squirrel to df
df <- .x %>%
# Exclude site and buff_dist
select(-site, -buff_dist)
# Treat array as a factor
df$array <- as.factor(df$array)
# Make sure columns are numeric
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# List to store the models
model_list <- map(numeric_columns, ~ {
# Create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Extract the unique value of buff_dist for naming
buff_dist_value <- unique(df$buff_dist)
# Generate the custom model name with variable, scale, and buff_dist
model_name <- paste0(.x, "_", deparse(substitute(.x)), "_buff_", buff_dist_value)
# Run the glmmTMB model for each numeric variable in the data frame
model <- glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
# Assign the custom model name to the model
names(model) <- model_name
model
})
model_list
}
)
squirrel_models <- purrr::flatten(squirrel_mods)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
squirrel_models <- purrr::flatten(squirrel_mods)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
str(squirrel_mods)
squirrel_models <- purrr::flatten(squirrel_mods)
str(squirrel_models)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
sapply(squirrel_models, class)
# Extract AICc for each model
model_AICs <- purrr::map_dbl(squirrel_models, ~ AICc(.x))
# Extract AICc for each model
model_AICs <- purrr::map_dbl(squirrel_models, ~ AIC(.x))
str(squirrel_models[[1]])
# Extract the glmmTMB model component and compute AIC
model_AICs <- purrr::map_dbl(squirrel_models, function(model_list) {
# Access the actual glmmTMB model from the nested list structure
model <- model_list[[length(model_list)]]  # The last item is the glmmTMB model
# Check if it's a glmmTMB object, then compute the AIC
if (inherits(model, "glmmTMB")) {
return(AIC(model))  # Return the AIC for the model
} else {
return(NA)  # Return NA if the model is not valid
}
})
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_mods) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
squirrel_models <- purrr::flatten(squirrel_mods)
str(squirrel_models)
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_mods) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
squirrel_models <- purrr::flatten(purrr::flatten(squirrel_mods))
# run model selection and save the results as a tibble for graphing use later
squirrel_global_model.sel <- model.sel(squirrel_models) %>%
as.data.frame() %>%
rownames_to_column(var = 'Model')  %>%
mutate(Dataset = deparse(substitute(squirrel)))
View(squirrel_mods)
str(squirrel_mods)
str(squirrel_mods)
View(squirrel_mods)
squirrel_mods[["250 meter buffer"]]
squirrel_mods[["250 meter buffer"]]
squirrel_mods[["1000 meter buffer"]]
squirrel_mods[["1000 meter buffer"]][[1]]
squirrel_mods <- squirrel %>%
squirrel_mods <- squirrel %>%
purrr::map(
~ {
# Pass squirrel to df and exclude site and buff_dist
df <- .x %>%
select(-site, -buff_dist)
# Treat array as a factor
df$array <- as.factor(df$array)
# Ensure numeric columns are handled correctly
numeric_columns <- df %>% select(where(is.numeric)) %>% names()
# List to store models
model_list <- map(numeric_columns, ~ {
# Create model formula
formula <- as.formula(paste("cbind(red_squirrel, absent_red_squirrel) ~",
.x, "+ (1 | array)"))
# Extract the unique value of buff_dist for naming (ensure a single value)
buff_dist_value <- unique(df$buff_dist)
if (length(buff_dist_value) != 1) {
stop("buff_dist is not unique across rows in the dataset!")
}
# Generate custom model name
model_name <- paste0(.x, "_buff_", buff_dist_value)
# Run the glmmTMB model for each numeric variable
model <- glmmTMB::glmmTMB(
formula = formula,
data = df,  # Ensure df is passed as the data
family = 'binomial'
)
