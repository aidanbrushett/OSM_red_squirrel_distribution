---
title: "1_data_cleaning"
output: html_document
date: "2025-03-19"

---

# Load libraries
```{r}
library(PerformanceAnalytics)
library(tidyverse)
```


## General cleaning/ checking and combining data 

# 1. Import the data and clean it up a bit

```{r}
# species presence absence data
dets <- read_csv("OSM_proportional_detections_merged_2021_2022.csv")

# we just need red squirrel detections 
dets <- dets %>%
  select(site, 
         red_squirrel, 
         absent_red_squirrel)

str(dets)
summary(dets)

# covariate data 
covs <- read_csv("OSM_covariates_grouped_2021_2022.csv")

str(covs)
summary(covs)

# all reading in ok

```

2. Merge the response and covariates
```{r}

# difference in row #s so I will check the site numbers 
length(unique(dets$site))
length(unique(covs$site))

# one site not in dets but probably camera that did not function 
```


## Data exploration 

# 1. Test for multicollinearity
```{r subset data}

buffer_frames <- list()

for (i in unique(covs$buff_dist)){
  
  print(i)
  
  # Subset data based on radius
  df <- covs %>%
    filter(buff_dist == i)
  
  # list of dataframes
  buffer_frames <-c (buffer_frames, list(df))
}

# name list objects so we can extract names for plotting 

buffer_frames <- buffer_frames %>% 
  
  # absurdly long way to do this but for sake of time fuck it
  purrr::set_names('250 meter buffer',
                   '500 meter buffer',
                   '750 meter buffer',
                   '1000 meter buffer',
                   '1250 meter buffer',
                   '1500 meter buffer',
                   '1750 meter buffer',
                   '2000 meter buffer',
                   '2250 meter buffer',
                   '2500 meter buffer',
                   '2750 meter buffer',
                   '3000 meter buffer',
                   '3250 meter buffer',
                   '3500 meter buffer',
                   '3750 meter buffer',
                   '4000 meter buffer',
                   '4250 meter buffer',
                   '4500 meter buffer',
                   '4750 meter buffer',
                   '5000 meter buffer')

```


```{r response metric}

squirrel <- buffer_frames %>% 
  
  purrr::map(
    ~.x %>% 
      
      left_join(dets,
                by = 'site'))
```


```{r correlation at all buffer sizes}

squirrel %>% 
  
  purrr::map(
    ~.x %>% 
      
      # select only columns with covaraites not other info
      select(harvest:osm_industrial) %>% 
      
      # use chart.correlation 
      chart.Correlation(.,
                        histogram = TRUE, 
                        method = "pearson")
  )

```

250m - roads and veg edges 0.71
500m - roads and veg edges 0.71
750m - pipeline + trans 0.63, roads + veg edges 0.73, conifer + broad -0.63
1000m - pipeline + trans 0.70, roads + veg edges 0.74, conifer + broad -0.66
        roads + developed 0.64
1250m - pipeline + trans 0.72, roads + veg edges 0.81, conifer + broad -0.66
        roads + developed 0.72, roads + wells 0.60, veg edges + developed 0.64
1500m - pipeline + trans 0.72, roads + veg edges 0.84, conifer + broad -0.70
        roads + developed 0.75, roads + wells 0.65, veg edges + developed 0.70
1750m - pipeline + trans 0.72, roads + veg edges 0.85, conifer + broad -0.71
        roads + developed 0.78, roads + wells 0.65, veg edges + developed 0.73
2000m - 
2250m -
2500m - 
2750m -
3000m - 





# 2. Explore the independent variables 
```{r}
# histograms of everything!

squirrel_cor %>% 
  
  # use imap which will retain both the data (x) and the variable names (y)
  imap(~.x %>% 
        
         # use the hist function on the data from previous pipe
        hist(.,
             
             # set the main title to y (each variable)
             main = .y))


# harvest has tons of zeros, same with transmission lines

```

# 3. Distribution of response variable 

```{r}
hist(squirrel$red_squirrel)
hist(squirrel$absent_red_squirrel)
```




