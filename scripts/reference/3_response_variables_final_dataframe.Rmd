---
title: "Merge data and calculate response variables"
author: "Aidan Brushett"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: default
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE)
```

------------------------------------------------------------------------

# 0. Before you begin

Aidan Brushett M.Sc. Student University of Victoria\
School of Environmental Studies\
Email: [aidanbrushett\@uvic.ca](aidanbrushett@uvic.ca)

------------------------------------------------------------------------

# 1. Set up workspace

## 1.1. Install packages

If you don't already have the following packages installed, use the code below to install them.

```{r install, eval=FALSE}
list.of.packages <- c("tidyverse", "sf", "ggplot2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
rm(new.packages, list.of.packages)
```

## 1.2. Load libraries

And a couple custom functions that can help with masking issues from package loading:

```{r libraries, message=FALSE, warning=FALSE}
rm(list=ls()) # clear environment

library(tidyverse) # data tidying, visualization, and much more; this will load all tidyverse packages, can see complete list using tidyverse_packages()
library(ggplot2) # pretty plots
library(sf) # spatial data

# These are functions that can sometimes get masked by other packages. Shouldn't be an issue and could be removed.
select <- dplyr::select
filter <- dplyr::filter
mutate <- dplyr::mutate
summarize <- dplyr::summarize
# Cheeky function that means "not in"
`%nin%` = Negate(`%in%`)
```

# 2. Import data

Independent detections:

```{r}
indet <- read_csv("./data/processed/all_arrays_independent_detections.csv",
                   col_types = cols(event_start = col_datetime(format = '%Y-%m-%dT%H:%M:%SZ'), 
                                    event_end = col_datetime(format = "%Y-%m-%dT%H:%M:%SZ"), 
                                    site = col_factor(),
                                    array = col_factor(),
                                    camera = col_factor(),
                                    species = col_factor(),
                                    year = col_integer(),
                                    month = col_integer()))

str(indet)
```

Camera operability:

```{r}
operating_raw <- read_csv("./data/processed/all_arrays_operating.csv",
                   col_types = cols(date = col_date(format = '%Y-%m-%d'), 
                                    site = col_factor(),
                                    array = col_factor(),
                                    camera = col_factor())) %>%
  select(-any_of('treatment')) %>%
  
  mutate(year = year(date),
         month = month(date))

str(operating_raw)
```

# 3. Generate response variables:

## 3.0. Set some basic parameters

For plotting and formatting proportional monthly detections we need to create a subset of the species in the detections data to just include several focal species we are interested in

```{r focal species}

# create a list of focal species for filtering the data/plots
 focal_species <- c('black bear',
                    'caribou',
                    'cougar',
                    'coyote',
                    'fisher',
                    'grey wolf',
                    'lynx',
                    'moose',
                    'red fox',
                    'white-tailed deer',
                    'wolverine',
                    'snowshoe hare', 
                    'red squirrel' 
                    )
```

We also don't want to use all of the Whitefish or Christina data, only a subset, so that we don't have a huge number of repeated measures within an array. We should filter these datasets to the time period of interest first to ensure that we are only reporting total detections or proportional presence based on the months we are interested in. The Gantt charts we created in script 2 (*'2_merge_array_data_qaqc.html'*) will be helpful for figuring out what period to use. We do not need perfectly aligning dates, but roughly 1 year of data per array is the target.

For Christina, we'll use the middle slice of data from 2012-09-01 to 2013-10-31. This is closer to the 2010 covariates that we extracted, and has the most cameras operating. This should represent between 11 and 13 months of data for each camera, which is reasonable and corresponds to the OSM period.

![](images/christina_deployment_history.png){width="615"}

Let's filter the operating days spreadsheet accordingly. We do not need to filter the independent detections data or the covariate data since they are going to be joined to this dataset in the end.

```{r}
operating <- operating_raw %>%
  filter(array != "CL" | 
           (array == "CL" & 
              date >= '2012-09-01' & 
              date <= '2013-09-30'))

```

Now let's repeat for the Whitefish array. It looks like taking out a slice of data from 2019-04-01 to 2020-04-30 is reasonable. This should represent between 11 and 13 months of data for each camera, which is reasonable and is similar to the duration we used for CL and OSM.

![](images/whitefish_deployment_history.png){width="615"}

Let's filter the operating days spreadsheet accordingly. We do not need to filter the independent detections data or the covariate data since they are going to be joined to this dataset in the end.

```{r}
operating <- operating %>%
  filter(array != "WF" | 
           (array == "WF" & 
              date >= '2019-04-01' & 
              date <= '2020-04-30'))

```

Now our data has a similar sampling duration for all arrays. Notably, LU2 and LU3 have a few cameras that stopped in February, and WF has a few cameras that were not deployed until June 2019. LU1 and LU2 also have some cameras that were deployed for up to 15 months. This might introduce a bit of temporal bias into our proportional presence data if hare presence varies seasonally. For now, this will just be saved as a caveat. If it introduces systematic bias into the data that affects models we can revisit this later.

Let's make sure our filters worked properly by plotting the operability quickly:

```{r}
for(i in c('CL', 'WF')) {

  array_operating <- operating %>% filter(array == i)

  fig_site_operability <- ggplot(array_operating, aes(x = date, y = site)) +
    geom_tile(height = 0.8, fill = "grey50") +  # Create horizontal tiles

    labs(title = paste0(i, ": Cropped Camera Operability"),
         x = "Date",
         y = "Site") +
      guides(fill = guide_legend(ncol = 2)) + # Set number of columns in the legend
      scale_x_date(date_labels = "%Y-%m", date_breaks = "2 months", minor_breaks = NULL) +  # 6-month interval
  
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate date labels
          axis.title.y = element_blank()) +  # Remove y-axis title  # Remove grid lines
    theme(
      panel.grid.major.y = element_blank(),  # Remove horizontal grid lines
      panel.grid.minor.y = element_blank(),  # Also remove minor horizontal grid lines
      axis.text.y = element_text(size = 6)  # Adjust y-axis font size (change 10 as needed)
    )
  
  print(fig_site_operability)
  #ggsave(paste0("./figures/arrays/", i, "_detections_operability_range.png"), fig_site_operability, width=12, height = 15)

  rm(array_operating, fig_site_operability)
}
```

## 3.1. Monthly independent detections and presence-absence

Bin the operating data monthly and retain months with \>15 days of data.

```{r}
operating_months <- operating %>%
  
  group_by(array, site, month, year) %>%
  
  summarize(n_days = n()) %>%
  
  filter(n_days >= 15) # retain months where there are 15 days of data only.
```

Then, let's bin the independent detections data into months. This data frame will only contain the positive detections. i.e., if a species was undetected for a given site/month, there will be no row.

```{r}
indet_months <- indet %>%
  
  filter(species %in% focal_species) %>%

  group_by(array, site, species, month, year) %>%
  
  summarize(presence = 1,
            detections = n())
```

Then, let's merge this to the operating data using left_join. This will ensure that our 'absence' cases now show up in the dataset.

```{r}
presence_months <- operating_months %>%
  
  # Ensure that we have a new row for each species x month combination. 
  crossing(species = focal_species) %>%
  
  left_join(indet_months, by = c("array", "site", "species", "month", "year")) %>%
  
  # Fill missing presence and detections with 0
  mutate(presence = replace_na(presence, 0),
         detections = replace_na(detections, 0),
         species = as.factor(species)) %>%
  
  select(-n_days)

summary(presence_months)
```

Save the file:

```{r}
write_csv(presence_months, "./data/processed/all_arrays_presence_detections_monthly_clean.csv")
```

## 3.2. Monthly proportional presence-absence

We will now create a proportional monthly variable for each species by determining how many months an animal was present, divided by the total months of data available.

```{r, message=FALSE}
proportional_months <- presence_months %>%
  
  group_by(array, site, species) %>%
  
  summarize(months_active = n(),
            months_present = sum(presence),
            .groups = 'drop')
```

Let's do a couple quick checks to make sure this worked. First, a visual inspection to make sure we have the same number of rows for each species and a reasonable range of active dates. Then, we'll check if any of the presence values exceed the active values, which would indicate an error.

```{r}
summary(proportional_months)

proportional_months %>%
  filter(months_present > months_active)
```

Now let's pivot the data to wide format :) We will also rename the species since they're now becoming column names and spaces or hyphens aren't acceptable. 

```{r, message=FALSE}
proportional_months <- proportional_months %>%
  
  # pivot the data wider so there is a column for each species and 1 row per site
  pivot_wider(names_from = species,
              values_from = months_present) %>% 
  
  # replace NAs with zeros in all species columns
  mutate(across(
    where(is.numeric),
    ~ replace_na(., 0))) %>%
  
  # ensure all species columns are numeric not integer
  mutate_if(is.integer,
            as.numeric) %>%
  
  # set the column names to lower case and replace the spaces with '_' (these are both personal preferences of mine)
  set_names(
    names(.) %>% 
      tolower()%>% 
      str_replace_all(pattern = ' ',
                      replacement = '_') %>%
      str_replace_all(pattern = '-',
                      replacement = "_"))
```

Now we can run the function below to create a second column for each species that will represent the number of absences (months the species was not detected) at each camera from the active months. This function was adopted from Marissa Dyck's OSM 2022-2023 image processing script, found on the ACME GitHub.

```{r}
# replace all non-letter digits with underscores to match the column names in the response variable. 
focal_species_colnames <- focal_species %>% 
  str_replace_all(., pattern = ' ', replacement = '_') %>%
  str_replace_all(., pattern = '-', replacement = '_')
  
# first convert data to data frame not a tibble for function to work
proportional_months <- as.data.frame(proportional_months)

# create a vector of the species columns for the loop
# update our focal species list to match the new column names
for (species in focal_species_colnames) {
  
  if (is.numeric(proportional_months[,species]) & is.numeric(proportional_months$months_active)) {
    col_absence <- paste0("absent_", species)
    
    proportional_months[col_absence] <- proportional_months$months_active - proportional_months[,species]

  }
}

str(proportional_months)
```

Let's adjust the black bear data to accommodate hibernation. We want bear data to represent only April to November.

```{r}
operating_months_bears <- operating_months %>%
  
  filter(month %in% c("4", "5", "6", "7", "8", "9", "10", "11")) %>%
  
  group_by(array, site) %>%
  
  summarize(months_active_bears = n(),
            .groups = 'drop')

# Update the months_active field for bears
proportional_months <- proportional_months %>%
  
  left_join(operating_months_bears, by = c('array', 'site')) %>%
  
  # overwrite absent black bear column
  mutate(absent_black_bear = months_active_bears - black_bear) %>%
  
  # get rid of unnecessary columns for active months
  select(-months_active_bears)

```

Save the file:

```{r}
write_csv(proportional_months, "./data/processed/all_arrays_proportional_presence_monthly_clean.csv")
```

Clean up our workspace:

```{r}
rm(operating_months_bears, operating_months, indet_months)
```

## 3.3. Weekly independent detections and presence-absence

Bin the operating data weekly and retain weeks with \>4 days of data. There is a handy function to do this!! `floor_date()` takes a date-time object and rounds it down to the nearest boundary of the specified time unit, starting on Sunday (default case). In this step, we will round down our operating data to the nearest week so we can bin it. We'll re-extract the month and year fields later.

```{r}
operating_weeks <- operating %>%
  
  mutate(week = floor_date(date, unit = "week")) %>%
  
  group_by(array, site, week) %>%
  
  summarize(n_days = n()) %>%
  
  filter(n_days >= 4) # retain weeks where there are 15 days of data only.
```

Then, let's bin the independent detections data into weeks. This data frame will only contain the positive detections. i.e., if a species was undetected for a given site/week, there will be no row.

```{r}
indet_weeks <- indet %>%
  
  filter(species %in% focal_species) %>%

  mutate(week = floor_date(event_start, unit = "week")) %>%
  
  group_by(array, site, week, species) %>%
  
  summarize(presence = 1,
            detections = n(),
            .groups = 'drop')
```

Then, let's merge this to the operating data using left_join. This will ensure that our 'absence' cases now show up in the dataset.

```{r}
presence_weeks <- operating_weeks %>%
  
  # Ensure that we have a new row for each species x week combination. 
  crossing(species = focal_species) %>%
  
  left_join(indet_weeks, by = c("array", "site", "species", "week")) %>%
  
  # Fill missing presence and detections with 0
  mutate(presence = replace_na(presence, 0),
         detections = replace_na(detections, 0),
         species = as.factor(species)) %>%
  
  mutate(month = month(week),
         year = year(week)) %>%
  
  select(-n_days)

summary(presence_weeks)
```

Save the file:

```{r}
write_csv(presence_weeks, "./data/processed/all_arrays_presence_detections_weekly_clean.csv")
```

## 3.4. Weekly proportional presence-absence

We will now create a proportional weekly variable for each species by determining how many weeks an animal was present, divided by the total weeks of data available.

```{r, message=FALSE}
proportional_weeks <- presence_weeks %>%
  
  group_by(array, site, species) %>%
  
  summarize(weeks_active = n(),
            weeks_present = sum(presence),
            .groups = 'drop')
```

Let's do a couple quick checks to make sure this worked. First, a visual inspection to make sure we have the same number of rows for each species and a reasonable range of active dates. Then, we'll check if any of the presence values exceed the active values, which would indicate an error.

```{r}
summary(proportional_weeks)

proportional_weeks %>%
  filter(weeks_present > weeks_active)
```

Now let's pivot the data to wide format :)

```{r, message=FALSE}
proportional_weeks <- proportional_weeks %>%
  
  # pivot the data wider so there is a column for each species and 1 row per site
  pivot_wider(names_from = species,
              values_from = weeks_present) %>% 
  
  # replace NAs with zeros in all species columns
  mutate(across(
    where(is.numeric),
    ~ replace_na(., 0))) %>%
  
  # ensure all species columns are numeric not integer
  mutate_if(is.integer,
            as.numeric) %>%
  
  # set the column names to lower case and replace the spaces with '_' (these are both personal preferences of mine)
  set_names(
    names(.) %>% 
      tolower()%>% 
      str_replace_all(pattern = ' ',
                      replacement = '_') %>%
      str_replace_all(pattern = '-',
                      replacement = "_"))
```

Now we can run the function below to create a second column for each species that will represent the number of absences (weeks the species was not detected) at each camera from the active weeks. This function was adopted from Marissa Dyck's OSM 2022-2023 image processing script, found on the ACME GitHub.

```{r}
# first convert data to data frame not a tibble for function to work
proportional_weeks <- as.data.frame(proportional_weeks)

# create a vector of the species columns for the loop
# update our focal species list to match the new column names
for (species in focal_species_colnames) {
  
  if (is.numeric(proportional_weeks[,species]) & is.numeric(proportional_weeks$weeks_active)) {
    col_absence <- paste0("absent_", species)
    
    proportional_weeks[col_absence] <- proportional_weeks$weeks_active - proportional_weeks[,species]

  }
}

str(proportional_weeks)
```

Let's adjust the black bear data to accommodate hibernation. We want bear data to represent only April to November.

```{r}
operating_weeks_bears <- operating_weeks %>% 
  
  mutate(month = month(week)) %>%
  
  filter(month %in% c(4:11)) %>%
  
  group_by(array, site) %>%
  
  summarize(weeks_active_bears = n(),
            .groups = 'drop')

# Update the weeks_active field for bears
proportional_weeks <- proportional_weeks %>%
  
  left_join(operating_weeks_bears, by = c('array', 'site')) %>%
  
  # overwrite absent black bear column
  mutate(absent_black_bear = weeks_active_bears - black_bear) %>%
  
  # get rid of unnecessary columns for active weeks
  select(-weeks_active_bears)

```

Save the file:

```{r}
write_csv(proportional_weeks, "./data/processed/all_arrays_proportional_presence_weekly_clean.csv")
```

Clean up our workspace:

```{r}
rm(operating_weeks_bears, operating_weeks, indet_weeks)
```

# 4. Visualize the response variables

Let's make a couple quick figures to represent our detections and get a sense for the amount of variation between sites and between arrays.

## 4.1. Monthly detections per site/array

This is a good proxy for overall density of a species across each landscape. 

```{r}
fig_month_det <- presence_months %>%
  
  filter(species %in% c('lynx', 'coyote', 'snowshoe hare', 'white-tailed deer')) %>%
  
  group_by(array, species) %>%
  
  summarize(total_det = sum(detections),
            total_months = n(),
            average_det = total_det / total_months) %>%
  
  ggplot(., aes(x = array, y = average_det)) + 
  
    geom_bar(stat = "identity", position = "dodge", fill = 'grey50') + 
  
    facet_wrap(~species, scales = 'fixed') +
  
    labs(x = "site",
         y = "average monthly detections per site") + 
    
    theme_bw() + 
  
    theme(
         axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
         strip.background = element_blank(),  # Remove facet background
         strip.text = element_text(face = "bold", size = 10)
         ) + 
    
    scale_y_continuous(expand = expansion(mult = c(0, 0.05)))  # Remove bottom space, keep small top space

fig_month_det
```

## 4.1. Monthly detections per site/array

This is a good proxy for overall density of a species across each landscape. Let's see if it varies much from our monthly metric. 

```{r}
fig_week_det <- presence_weeks %>%
  
  filter(species %in% c('lynx', 'coyote', 'snowshoe hare', 'white-tailed deer')) %>%
  
  group_by(array, species) %>%
  
  summarize(total_det = sum(detections),
            total_weeks = n(),
            average_det = total_det / total_weeks) %>%
  
  ggplot(., aes(x = array, y = average_det)) + 
  
    geom_bar(stat = "identity", position = "dodge", fill = 'grey50') + 
  
    facet_wrap(~species, scales = 'fixed') +
  
    labs(x = "array",
         y = "average weekly detections per site") + 
    
    theme_bw() + 
  
    theme(
         axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
         strip.background = element_blank(),  # Remove facet background
         strip.text = element_text(face = "bold", size = 10)
         ) + 
    
    scale_y_continuous(expand = expansion(mult = c(0, 0.05)))  # Remove bottom space, keep small top space

fig_week_det
```

## 4.2. Naive occupancy per array

```{r}
fig_occ_total <- presence_months %>%
  
  filter(species %in% c('lynx', 'coyote', 'snowshoe hare', 'white-tailed deer')) %>%
  
#  filter(species %in% c('red squirrel')) %>%
  
  group_by(array, site, species) %>%
  
  summarize(presence = max(presence)) %>%
  
  group_by(array, species) %>%
  
  summarize(n_sites = n(), 
            n_present = sum(presence),
            naive_occ = n_present / n_sites,
            .groups = 'drop') %>%
  
  ggplot(., aes(x = array)) + 
  
    geom_bar(aes(y = n_sites), stat = "identity", fill = "grey50") +  # Total sites in grey
  
    geom_bar(aes(y = n_present), stat = "identity", fill = "firebrick") +  # Present sites in red
  
    geom_text(aes(y = n_sites + 6, label = round(naive_occ, 2)), size = 2.7, fontface = "italic") +  # Label above bars
  
    theme_bw() + 
  
    facet_wrap(~species, scales = 'fixed') +
  
    labs(x = "array",
         y = "sites occupied // total sites") + 
    

    theme(
         axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
         strip.background = element_blank(),  # Remove facet background
         strip.text = element_text(face = "bold", size = 10)
         ) + 
    
    scale_y_continuous(expand = expansion(mult = c(0, 0.05)))  # Remove bottom space, keep small top space

fig_occ_total
  
```

## 4.3. Temporal variation in detections

Does snowshoe hare density fluctuate substantially through the study period? If so, our uneven sampling among arrays (i.e., seasons and months that cameras were deployed) could create some issues. 

```{r}
fig_seasonal_det <- presence_months %>%
  
  filter(species %in% c('coyote', 'lynx', 'snowshoe hare')) %>%
  
  group_by(array, site, species, year, month) %>%
  
  summarize(det = sum(detections)) %>%
  
  group_by(array, species, year, month) %>%
  
  summarize(n_sites = n(),
            total_det = sum(det),
            avg_det = total_det / n_sites) %>%
  
  mutate(yearmonth = ym(paste(year, month, sep = "-"))) %>%  # Creates Year-Month column
  
  ggplot(., aes(x = yearmonth, y = avg_det, color = species)) +
    
    #geom_bar(stat = "identity", position = "dodge", fill = 'grey20') + 
    
    geom_line(linewidth = 1) +  # Use lines instead of bars
  
    scale_color_viridis_d() +
  
    #geom_point(size = 1.5, color = 'grey20') +  # Optional: Add points to mark data
  
    facet_wrap(~array, scales = 'free_x') +
  
    labs(y = "monthly detections per site") + 
    
    theme_bw() + 
  
    theme(
         axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
         strip.background = element_blank(),  # Remove facet background
         strip.text = element_text(face = "bold", size = 10),
         panel.background = element_rect(fill = "white"),  # Set light gray background
         panel.grid.major.y = element_blank(),
         panel.grid.minor.y = element_blank()# Remove horizontal grid lines on the plot
         ) + 

    scale_x_date(date_labels = "%b '%y", date_breaks = "2 months", minor_breaks = NULL) +  # 6-month interval

    scale_y_continuous(expand = expansion(mult = c(0, 0.05)))  # Remove bottom space, keep small top space

fig_seasonal_det
```

It doesn't look too too variable to be quite honest, I think that we are likely not introducing any crazy bias into our data by using a proportional response with variable months among arrays/sites. The coolest thing to see is the huge difference in detections per site. 


## If we pool all of our boreal plain data, I wonder if we can extrapolate the hare cycle?

First we'll basically repeat the steps we used above but with *all* the independent detection and operability data. 

```{r}
fig_hare_ops <- operating_raw %>%
  
  group_by(array, site, month, year) %>%
  
  summarize(n_days = n()) %>%
  
  filter(n_days >= 15) # retain months where there are 15 days of data only.
```

Summarize the detections into monthly counts for all possible data. 

```{r}
fig_hare_indets <- indet %>%
  
  filter(species %in% focal_species) %>%

  group_by(array, site, species, month, year) %>%
  
  summarize(presence = 1,
            detections = n())
```

Then, let's merge this to the operating data using left_join. This will ensure that our 'absence' cases now show up in the dataset.

```{r}
fig_hare_cycle_presence <- fig_hare_ops %>%
  
  # Ensure that we have a new row for each species x month combination. 
  crossing(species = focal_species) %>%
  
  left_join(fig_hare_indets, by = c("array", "site", "species", "month", "year")) %>%
  
  # Fill missing presence and detections with 0
  mutate(presence = replace_na(presence, 0),
         detections = replace_na(detections, 0),
         species = as.factor(species)) %>%
  
  select(-n_days)
```

Make the figure:

```{r}
fig_hare_cycle <- fig_hare_cycle_presence %>%
  
  filter(species %in% c('coyote', 'snowshoe hare', 'lynx')) %>%
  
  group_by(year, month, species) %>%
  
  summarize(n_sites = n(),
            total_det = sum(detections),
            avg_det = total_det / n_sites) %>%
  
  mutate(yearmonth = ym(paste(year, month, sep = "-"))) %>% # Creates Year-Month column
  
  group_by(year, species) %>%
  
  summarize(avg_det = mean(avg_det)) %>%
  
  ggplot(., aes(x = year, y = avg_det, fill = species)) +
    
    geom_bar(stat = "identity", position = "dodge2") + 
    
    #scale_fill_viridis_d() +
  
    #scale_fill_manual(values = c("lightskyblue",  "mediumseagreen", "gold")) +
  
    #geom_point(size = 1.5, color = 'grey20') +  # Optional: Add points to mark data
  
    labs(y = "monthly detections per site", x= NULL) + 
    
    theme_bw() + 
  
    theme(
         axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
         strip.background = element_blank(),  # Remove facet background
         strip.text = element_text(face = "bold", size = 10),
         panel.background = element_rect(fill = "white"),  # Set light gray background
         panel.grid.minor.y = element_blank(),
         ) + 

    #scale_x_date(date_labels = "%Y", date_breaks = "12 months", minor_breaks = NULL) +  # 6-month interval
    scale_x_continuous(breaks = 2011:2024) +  # Ensure every year is shown
  
    scale_y_continuous(expand = expansion(mult = c(0, 0.05)))  # Remove bottom space, keep small top space

fig_hare_cycle

ggsave("./figures/archive/all_arrays_hare_cycle.png", fig_hare_cycle, width = 7, height = 4)

```

