---
title: "Modelling"
output: html_document
date: "2025-03-20"
---

```{r libraries}
library(MuMIn)
library(glmmTMB)
library(tidyverse)
library(broom) 
library(PerformanceAnalytics)
```

```{r data for modelling}

data_wide <- read_csv("data/processed/analysis_df_wide.csv")

```

## 1. Models 

The "core model" is the best performing habitat model that will be used in 
subsequent models. 

Broadleaf and conifer are too highly correlated to put in the top model. What do we do about this? 
run a model with each of them and compete AIC? 
conifer model: 5290.4
broadlead model: 5223. 

Lets keep conifer for now but come back to this later


```{r null model}
null <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 1 +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")
```

```{r the core model - 750 meter scale (H0)}

core_0 <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(lc_coniferous_750)  + 
                     scale(lc_shrub_750) +
                     scale(lc_grassland_750)  +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

core_b <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(lc_broadleaf_750)  + 
                     scale(lc_shrub_750) +
                     scale(lc_grassland_750)  +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

summary(core_0)
summary(core_c)

```
CORE AIC: 5290.4


Roads and wells are highly correlated at 2000 m (0.66) so we removed roads. Roads and linear were 

```{r the disturbance model}

dist <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(seismic_2000)  +
                     scale(linear_2000) +
                    #scale(roads_2000)
                     scale(harvest_2000)  +
                     scale(wells_2000) +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

summary(dist)
```

```{r the natural + disturbance model (H1)}

dist_1 <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(lc_coniferous_750)  + 
                     scale(lc_shrub_750) +
                     scale(lc_grassland_750)  +
                     scale(seismic_2000)  +
                     scale(linear_2000) +
                     scale(harvest_2000)  +
                     scale(wells_2000) +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

summary(dist_1)
```

CORE + DIST AIC: 5073.0

```{r the configuration model}
config_nat <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(natural_cohesion_250) + 
                     scale(natural_tca_250) +
                     #natural_ed_250 +
                    # anthropogenic_ed_250 +
                     #anthropogenic_tca_250 +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

config_anth_ed <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~
                     scale(natural_cohesion_250) + 
                     #natural_tca_250 +
                     #natural_ed_250 +
                     scale(anthropogenic_ed_250) +
                     #anthropogenic_tca_250 +
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")
summary(config_nat)
summary(config_anth_ed)

```

What the heck do we do here?

natural_ed and anthro_ed are 1.00
natural_ed and natural tca are -0.69
anthro_ed and natural_tca are 0.63
seismic and natural ed are 0.88
seismic and anthropogenic_ed are 0.88
natural_tca and anthro_tca are -0.65


take out anthropogenic_tca, so we can use harvest

anthro_edge comes out on top so lets just use that 


```{r the natural + configuration (H2)}
config_2 <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(lc_coniferous_750)  + 
                     scale(lc_shrub_750) +
                     scale(lc_grassland_750)  +
                     scale(natural_cohesion_250) + 
                     scale(anthropogenic_ed_250) +       
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

summary(config_2)
```

CORE + CONFIG AIC: 4681.4

```{r the natural + configuration + dist (H3)}
core_dist_config_3 <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(lc_coniferous_750)  + 
                     scale(lc_shrub_750) +
                     scale(lc_grassland_750)  +
                     #scale(seismic_2000)  +
                     scale(linear_2000) +
                    # scale(roads_2000) +
                     scale(harvest_2000)  +
                     scale(wells_2000) +
                     scale(natural_cohesion_250) + 
                     scale(anthropogenic_ed_250) +   
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

summary(core_dist_config_3)

```
remove seismic for the additive model 
CORE + CONFIG + DIST AIC: 4550.6


Interactions: 
conifer is 0.16
linear is 0.34
anth edge is -0.14

anthropogenic_edge*conifer
conifer*cohesion

```{r the natural + configuration * dist (H4)}
core_dist_config_4 <- glmmTMB::glmmTMB(cbind(red_squirrel, absent_red_squirrel) ~ 
                     scale(lc_coniferous_750)*scale(anthropogenic_ed_250) +  
                     scale(lc_shrub_750) +
                     scale(lc_grassland_750)  +
                     #scale(seismic_2000)  +
                     scale(linear_2000) +
                     #scale(roads_2000) +
                     scale(harvest_2000)  +
                     scale(wells_2000) +
                     scale(natural_cohesion_250) + 
                     #scale(anthropogenic_ed_250)+
                     (1|array), 
                     data = data_wide, 
                     family = "binomial")

summary(core_dist_config_4)


```

high prop conifer, edge effects smaller !!!!!!!!!!!!!

```{r model selection}

model.sel(null, core_0, dist_1, config_2, core_dist_config_3, core_dist_config_4)

```